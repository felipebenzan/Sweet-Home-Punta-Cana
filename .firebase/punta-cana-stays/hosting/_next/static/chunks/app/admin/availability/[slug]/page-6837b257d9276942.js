(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8780],{6301:function(e,s,a){Promise.resolve().then(a.bind(a,88587))},88587:function(e,s,a){"use strict";a.d(s,{default:function(){return U}});var t=a(57437),l=a(2265),n=a(27648),r=a(63070),c=a(27742),i=a(2901),d=a(54886),o=a(60936),u=a(16357),m=a(35902),x=a(31091),f=a(82521),h=a(38276),b=a(95490),v=a(69626),j=a(53459),y=a(5978),p=a(74348),g=a(12381),N=a(79820),w=a(93448),C=a(75060),k=a(40279),M=a(86700),S=a(23340),E=a(22003),z=a(69140);function U(e){let{slug:s}=e,a=(0,p.CU)(),{toast:U}=(0,S.pm)(),[$,W]=l.useState(null),[Z,_]=l.useState([]),[D,O]=l.useState(new Date),[A,I]=l.useState([]),[F,K]=l.useState(null),[q,B]=l.useState(!0),[J,R]=l.useState(!0),[T,V]=l.useState(!1),[H,P]=l.useState(null);l.useEffect(()=>{!async function(){if(s){B(!0),R(!0);try{let e=await (0,E.CZ)(s);if(!e){U({title:"Error",description:"Room not found.",variant:"destructive"});return}W(e);let a=await (0,E.QJ)(e.id);_(a)}catch(e){console.error("Failed to fetch room or reservations:",e),U({title:"Error",description:"Could not load room data.",variant:"destructive"})}finally{B(!1),R(!1)}}}()},[s,U]);let L=(0,r.N)(D),Q=(0,c.V)(D),Y=(0,p.sx)(()=>a&&(null==$?void 0:$.id)?(0,y.IO)((0,y.hJ)(a,"rates/".concat($.id,"/calendar")),(0,y.ar)("date",">=",(0,i.WU)(L,"yyyy-MM-dd")),(0,y.ar)("date","<=",(0,i.WU)(Q,"yyyy-MM-dd"))):null,[a,null==$?void 0:$.id,D]),{data:G,isLoading:X}=(0,p.Kx)(Y),ee=l.useMemo(()=>{let e={};return $&&((0,d.D)({start:L,end:Q}).forEach(s=>{var a,t;let l=(0,i.WU)(s,"yyyy-MM-dd");e[l]={date:l,isClosed:!1,manualInventory:null!==(a=$.inventoryUnits)&&void 0!==a?a:1,bookedCount:0,price:null!==(t=$.price)&&void 0!==t?t:0}}),null==G||G.forEach(s=>{let a=s.date;e[a]&&(e[a].isClosed=s.closed||!1,e[a].manualInventory=s.available,e[a].price=s.price)}),null==Z||Z.forEach(s=>{try{let a=(0,o.D)(s.checkInDate),t=(0,o.D)(s.checkOutDate);(0,d.D)({start:a,end:t}).forEach(s=>{if(s<t){let a=(0,i.WU)(s,"yyyy-MM-dd");e[a]&&(e[a].bookedCount+=1)}})}catch(e){console.error("Could not parse reservation dates for ".concat(s.id),e)}})),e},[$,G,Z,D]);l.useEffect(()=>{if(A.length>0&&$){var e,s,a,t;let l=ee[(0,i.WU)(A[0],"yyyy-MM-dd")];K({closed:(null==l?void 0:l.isClosed)||!1,available:null!==(s=null!==(e=null==l?void 0:l.manualInventory)&&void 0!==e?e:$.inventoryUnits)&&void 0!==s?s:1,price:null!==(t=null!==(a=null==l?void 0:l.price)&&void 0!==a?a:$.price)&&void 0!==t?t:0})}else K(null)},[A,ee,$]);let es=async()=>{if(!F||!$||!a||0===A.length){U({title:"Save Aborted",description:"Missing required data to save.",variant:"destructive"});return}V(!0),P(null);let e=(0,y.qs)(a);for(let s of A){let t=(0,i.WU)(s,"yyyy-MM-dd"),l=(0,y.JU)(a,"rates/".concat($.id,"/calendar/").concat(t)),n={roomId:$.id,slug:$.slug,date:t,price:F.price,available:F.available,closed:F.closed,source:"manual",updatedAt:y.EK.now()};e.set(l,n,{merge:!0})}try{await e.commit(),U({title:"Success",description:"Availability updated successfully."}),I([])}catch(s){let e=new p.b$({path:"rates/".concat($.id,"/calendar"),operation:"write",requestResourceData:{closed:F.closed,available:F.available,price:F.price}});p.s5.emit("permission-error",e),P(e.message),U({title:"Save Failed",description:"Check diagnostics for details.",variant:"destructive"})}finally{V(!1)}},ea=e=>{F&&K({...F,...e(F)})},et=e=>{ea(()=>({closed:"closed"===e}))},el=e=>{ea(s=>{var a;return{available:Math.max(0,(null!==(a=null==s?void 0:s.available)&&void 0!==a?a:0)+e)}})},en=q||X||J,er=(0,r.N)(D),ec=(0,d.D)({start:er,end:(0,c.V)(D)}),ei=e=>{let s=ee[(0,i.WU)(e,"yyyy-MM-dd")];if(!s)return{text:"Loading...",color:"bg-gray-100",netAvailable:0};let{isClosed:a,manualInventory:t,bookedCount:l}=s,n=t-l;return a?{text:"Closed",color:"bg-red-200 text-red-800",netAvailable:n}:n<=0?{text:"Sold Out",color:"bg-yellow-200 text-yellow-800",netAvailable:n}:l>0?{text:"".concat(l," Booked"),color:"bg-yellow-100 text-yellow-700",netAvailable:n}:{text:"Available",color:"bg-green-200 text-green-800",netAvailable:n}},ed=e=>{A.some(s=>(0,u.K)(s,e))?I(A.filter(s=>!(0,u.K)(s,e))):I([...A,e])},eo=A.length>0?(0,i.WU)(A[0],"yyyy-MM-dd"):null,eu=eo?ee[eo]:null;return(0,t.jsxs)("div",{className:"p-4 sm:p-6 bg-shpc-sand min-h-screen",children:[(0,t.jsxs)("header",{className:"flex items-center justify-between mb-6",children:[(0,t.jsx)(g.z,{asChild:!0,variant:"ghost",size:"icon",disabled:!$,children:(0,t.jsxs)(n.default,{href:"/admin/availability",children:[(0,t.jsx)(f.Z,{className:"h-6 w-6"}),(0,t.jsx)("span",{className:"sr-only",children:"Back"})]})}),(0,t.jsx)("div",{className:"text-center",children:en?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(z.O,{className:"h-4 w-48 mx-auto"}),(0,t.jsx)(z.O,{className:"h-7 w-32 mx-auto mt-1"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Sweet Home Punta Cana Guest House"}),(0,t.jsxs)("h1",{className:"text-xl font-bold text-shpc-ink flex items-center gap-2 justify-center",children:[(0,t.jsx)(h.Z,{className:"h-5 w-5"}),null==$?void 0:$.name]})]})}),(0,t.jsx)("div",{className:"w-10"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-4",children:[(0,t.jsx)(g.z,{variant:"ghost",size:"icon",onClick:()=>O((0,m.W)(D,1)),children:(0,t.jsx)(f.Z,{className:"h-5 w-5"})}),(0,t.jsx)("h2",{className:"text-lg font-semibold text-center w-40",children:(0,i.WU)(D,"MMMM yyyy")}),(0,t.jsx)(g.z,{variant:"ghost",size:"icon",onClick:()=>O((0,x.z)(D,1)),children:(0,t.jsx)(f.Z,{className:"h-5 w-5 rotate-180"})})]}),en?(0,t.jsx)(z.O,{className:"h-80 w-full"}):(0,t.jsxs)("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[(0,t.jsx)("div",{className:"grid grid-cols-7 text-center text-sm font-semibold text-muted-foreground p-2",children:["S","M","T","W","T","F","S"].map((e,s)=>(0,t.jsx)("div",{children:e},"".concat(e,"-").concat(s)))}),(0,t.jsxs)("div",{className:"grid grid-cols-7 border-t",children:[Array.from({length:er.getDay()}).map((e,s)=>(0,t.jsx)("div",{className:"h-20 border-l border-b"},"empty-start-".concat(s))),ec.map(e=>{let s=(0,i.WU)(e,"yyyy-MM-dd"),a=A.some(s=>(0,u.K)(s,e)),{text:l,color:n,netAvailable:r}=ei(e);return(0,t.jsxs)("button",{onClick:()=>ed(e),className:(0,w.cn)("h-20 flex flex-col items-center justify-center transition-colors focus:outline-none border-l border-b p-1 text-center",n,a&&"ring-2 ring-primary ring-offset-1 z-10"),children:[(0,t.jsx)("span",{className:"font-semibold text-lg",children:(0,i.WU)(e,"d")}),(0,t.jsx)("span",{className:"text-xs font-medium",children:l}),(0,t.jsxs)("span",{className:"text-xs",children:[r," left"]})]},s)}),Array.from({length:(7-((0,c.V)(D).getDay()+1))%7}).map((e,s)=>(0,t.jsx)("div",{className:"h-20 border-l border-b"},"empty-end-".concat(s)))]})]}),A.length>0&&F&&(0,t.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:null==$?void 0:$.name}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Editing ",A.length," ",1===A.length?"date":"dates"]})]}),(0,t.jsx)(N.Zb,{className:"shadow-soft rounded-2xl",children:(0,t.jsxs)(N.aY,{className:"p-4 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(C._,{children:"Booking Status"}),(0,t.jsxs)(M.E,{value:F.closed?"closed":"open",onValueChange:e=>et(e),className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(M.m,{value:"open",id:"open"}),(0,t.jsx)(C._,{htmlFor:"open",children:"Open"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(M.m,{value:"closed",id:"closed"}),(0,t.jsx)(C._,{htmlFor:"closed",children:"Close"})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(C._,{children:"Total Inventory"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(g.z,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>el(-1),disabled:F.closed,children:(0,t.jsx)(b.Z,{className:"h-4 w-4"})}),(0,t.jsx)("span",{className:"font-bold text-lg w-8 text-center",children:F.available}),(0,t.jsx)(g.z,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>el(1),disabled:F.closed,children:(0,t.jsx)(v.Z,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(C._,{children:"Nightly Price"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"$"}),(0,t.jsx)(k.I,{type:"number",value:F.price,onChange:e=>ea(()=>({price:Number(e.target.value)})),className:"w-24 font-bold text-lg text-right",disabled:F.closed})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(C._,{className:"text-muted-foreground",children:"Booked"}),(0,t.jsx)("span",{className:"font-bold",children:(null==eu?void 0:eu.bookedCount)||0})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between font-semibold",children:[(0,t.jsx)(C._,{children:"Net Available"}),(0,t.jsx)("span",{children:Math.max(0,F.available-((null==eu?void 0:eu.bookedCount)||0))})]})]})}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(g.z,{variant:"outline",onClick:()=>I([]),className:"w-full",children:"Clear"}),(0,t.jsxs)(g.z,{onClick:es,className:"bg-shpc-yellow text-shpc-ink hover:bg-shpc-yellow/90 w-full",disabled:T,children:[T&&(0,t.jsx)(j.Z,{className:"mr-2 h-4 w-4 animate-spin"}),T?"Saving...":"Save for ".concat(A.length," Day(s)")]})]}),H&&(0,t.jsxs)(N.Zb,{className:"shadow-soft rounded-2xl bg-destructive/10 border-destructive",children:[(0,t.jsxs)(N.Ol,{children:[(0,t.jsx)(N.ll,{className:"text-destructive",children:"Error Saving"}),(0,t.jsx)(N.SZ,{className:"text-destructive/80",children:"The database rejected the save operation. Here's the error:"})]}),(0,t.jsx)(N.aY,{children:(0,t.jsx)("pre",{className:"text-xs bg-background p-2 rounded-md overflow-x-auto",children:(0,t.jsx)("code",{children:H})})})]})]})]})}},22003:function(e,s,a){"use strict";a.d(s,{A4:function(){return n},CZ:function(){return r},QJ:function(){return l}}),a(83079);var t=a(12119),l=(0,t.$)("da051a643c3880f489e81df14700d6dd27ac56ca"),n=(0,t.$)("ce0db617e3c9d8439e2ab979864996f958677e2e");(0,t.$)("a7cae521949b5dbc40e299915e1092f5ab911e6d");var r=(0,t.$)("341dcc14a4a1d8dff23f542d88558b1557c7a424");(0,t.$)("d89d5e5ed59c4d5d1025992738ab94ab5e8d2afb"),(0,t.$)("e6d277f7333fa04ff5b64cb76b0110ece93247f6"),(0,t.$)("1dff9ab79ea935a62962951c91f386cd590ea298"),(0,t.$)("84adc51f62eaf5aa469181a839563225cc464a7f"),(0,t.$)("d0e69fe954dd88ba8c3b848ab5ca458e6b618292"),(0,t.$)("72e14d31d272c8baafbe4544aa2dd4c4c829ca4d"),(0,t.$)("7bb8958bad4ccd3df9fbbd4a99efa8471bb764fc")},86700:function(e,s,a){"use strict";a.d(s,{E:function(){return i},m:function(){return d}});var t=a(57437),l=a(2265),n=a(42325),r=a(78084),c=a(93448);let i=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(n.fC,{className:(0,c.cn)("grid gap-2",a),...l,ref:s})});i.displayName=n.fC.displayName;let d=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(n.ck,{ref:s,className:(0,c.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),...l,children:(0,t.jsx)(n.z$,{className:"flex items-center justify-center",children:(0,t.jsx)(r.Z,{className:"h-2.5 w-2.5 fill-current text-current"})})})});d.displayName=n.ck.displayName},69140:function(e,s,a){"use strict";a.d(s,{O:function(){return n}});var t=a(57437),l=a(93448);function n(e){let{className:s,...a}=e;return(0,t.jsx)("div",{className:(0,l.cn)("animate-pulse rounded-md bg-muted",s),...a})}}},function(e){e.O(0,[4728,4358,6137,2972,9242,9666,3301,2901,9221,1056,1954,268,2971,2117,1744],function(){return e(e.s=6301)}),_N_E=e.O()}]);