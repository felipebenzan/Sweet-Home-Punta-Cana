(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8780],{67879:function(e,s,t){Promise.resolve().then(t.bind(t,82823))},82823:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return W}});var l=t(57437),a=t(2265),n=t(27648),r=t(63070),i=t(27742),c=t(2901),d=t(54886),o=t(60936),u=t(16357),m=t(35902),x=t(31091),h=t(82521),f=t(38276),v=t(95490),y=t(69626),j=t(53459),p=t(5978),b=t(74348),g=t(12381),N=t(79820),w=t(93448),C=t(75060),k=t(40279),M=t(86700),S=t(23340),E=t(69140);async function z(e){let{firestore:s}=(0,b.hL)(),t=(0,p.hJ)(s,"rooms"),l=(0,p.IO)(t,(0,p.ar)("slug","==",e)),a=await (0,p.PL)(l);if(a.empty)return null;let n=a.docs[0];return{...n.data(),id:n.id}}async function U(e){let{firestore:s}=(0,b.hL)(),t=(0,p.hJ)(s,"reservations"),l=(0,p.IO)(t,(0,p.ar)("roomId","==",e)),a=await (0,p.PL)(l);return a.empty?[]:a.docs.map(e=>({id:e.id,...e.data()}))}function O(e){let{slug:s}=e,t=(0,b.CU)(),{toast:O}=(0,S.pm)(),[W,_]=a.useState(null),[D,I]=a.useState([]),[Z,A]=a.useState(new Date),[F,L]=a.useState([]),[K,P]=a.useState(null),[q,B]=a.useState(!0),[J,R]=a.useState(!0),[T,V]=a.useState(!1),[H,$]=a.useState(null);a.useEffect(()=>{!async function(){if(s){B(!0),R(!0);try{let e=await z(s);if(!e){O({title:"Error",description:"Room not found.",variant:"destructive"});return}_(e);let t=await U(e.id);I(t)}catch(e){console.error("Failed to fetch room or reservations:",e),O({title:"Error",description:"Could not load room data.",variant:"destructive"})}finally{B(!1),R(!1)}}}()},[s,O]);let Y=(0,r.N)(Z),G=(0,i.V)(Z),Q=(0,b.sx)(()=>t&&(null==W?void 0:W.id)?(0,p.IO)((0,p.hJ)(t,"rates/".concat(W.id,"/calendar")),(0,p.ar)("date",">=",(0,c.WU)(Y,"yyyy-MM-dd")),(0,p.ar)("date","<=",(0,c.WU)(G,"yyyy-MM-dd"))):null,[t,null==W?void 0:W.id,Z]),{data:X,isLoading:ee}=(0,b.Kx)(Q),es=a.useMemo(()=>{let e={};return W&&((0,d.D)({start:Y,end:G}).forEach(s=>{var t,l;let a=(0,c.WU)(s,"yyyy-MM-dd");e[a]={date:a,isClosed:!1,manualInventory:null!==(t=W.inventoryUnits)&&void 0!==t?t:1,bookedCount:0,price:null!==(l=W.price)&&void 0!==l?l:0}}),null==X||X.forEach(s=>{let t=s.date;e[t]&&(e[t].isClosed=s.closed||!1,e[t].manualInventory=s.available,e[t].price=s.price)}),null==D||D.forEach(s=>{try{let t=(0,o.D)(s.checkInDate),l=(0,o.D)(s.checkOutDate);(0,d.D)({start:t,end:l}).forEach(s=>{if(s<l){let t=(0,c.WU)(s,"yyyy-MM-dd");e[t]&&(e[t].bookedCount+=1)}})}catch(e){console.error("Could not parse reservation dates for ".concat(s.id),e)}})),e},[W,X,D,Z]);a.useEffect(()=>{if(F.length>0&&W){var e,s,t,l;let a=es[(0,c.WU)(F[0],"yyyy-MM-dd")];P({closed:(null==a?void 0:a.isClosed)||!1,available:null!==(s=null!==(e=null==a?void 0:a.manualInventory)&&void 0!==e?e:W.inventoryUnits)&&void 0!==s?s:1,price:null!==(l=null!==(t=null==a?void 0:a.price)&&void 0!==t?t:W.price)&&void 0!==l?l:0})}else P(null)},[F,es,W]);let et=async()=>{if(!K||!W||!t||0===F.length){O({title:"Save Aborted",description:"Missing required data to save.",variant:"destructive"});return}V(!0),$(null);let e=(0,p.qs)(t);for(let s of F){let l=(0,c.WU)(s,"yyyy-MM-dd"),a=(0,p.JU)(t,"rates/".concat(W.id,"/calendar/").concat(l)),n={roomId:W.id,slug:W.slug,date:l,price:K.price,available:K.available,closed:K.closed,source:"manual",updatedAt:p.EK.now()};e.set(a,n,{merge:!0})}try{await e.commit(),O({title:"Success",description:"Availability updated successfully."}),L([])}catch(s){let e=new b.b$({path:"rates/".concat(W.id,"/calendar"),operation:"write",requestResourceData:{closed:K.closed,available:K.available,price:K.price}});b.s5.emit("permission-error",e),$(e.message),O({title:"Save Failed",description:"Check diagnostics for details.",variant:"destructive"})}finally{V(!1)}},el=e=>{K&&P({...K,...e(K)})},ea=e=>{el(()=>({closed:"closed"===e}))},en=e=>{el(s=>{var t;return{available:Math.max(0,(null!==(t=null==s?void 0:s.available)&&void 0!==t?t:0)+e)}})},er=q||ee||J,ei=(0,r.N)(Z),ec=(0,d.D)({start:ei,end:(0,i.V)(Z)}),ed=e=>{let s=es[(0,c.WU)(e,"yyyy-MM-dd")];if(!s)return{text:"Loading...",color:"bg-gray-100",netAvailable:0};let{isClosed:t,manualInventory:l,bookedCount:a}=s,n=l-a;return t?{text:"Closed",color:"bg-red-200 text-red-800",netAvailable:n}:n<=0?{text:"Sold Out",color:"bg-yellow-200 text-yellow-800",netAvailable:n}:a>0?{text:"".concat(a," Booked"),color:"bg-yellow-100 text-yellow-700",netAvailable:n}:{text:"Available",color:"bg-green-200 text-green-800",netAvailable:n}},eo=e=>{F.some(s=>(0,u.K)(s,e))?L(F.filter(s=>!(0,u.K)(s,e))):L([...F,e])},eu=F.length>0?(0,c.WU)(F[0],"yyyy-MM-dd"):null,em=eu?es[eu]:null;return(0,l.jsxs)("div",{className:"p-4 sm:p-6 bg-shpc-sand min-h-screen",children:[(0,l.jsxs)("header",{className:"flex items-center justify-between mb-6",children:[(0,l.jsx)(g.z,{asChild:!0,variant:"ghost",size:"icon",disabled:!W,children:(0,l.jsxs)(n.default,{href:"/admin/availability",children:[(0,l.jsx)(h.Z,{className:"h-6 w-6"}),(0,l.jsx)("span",{className:"sr-only",children:"Back"})]})}),(0,l.jsx)("div",{className:"text-center",children:er?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(E.O,{className:"h-4 w-48 mx-auto"}),(0,l.jsx)(E.O,{className:"h-7 w-32 mx-auto mt-1"})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"Sweet Home Punta Cana Guest House"}),(0,l.jsxs)("h1",{className:"text-xl font-bold text-shpc-ink flex items-center gap-2 justify-center",children:[(0,l.jsx)(f.Z,{className:"h-5 w-5"}),null==W?void 0:W.name]})]})}),(0,l.jsx)("div",{className:"w-10"})]}),(0,l.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-4",children:[(0,l.jsx)(g.z,{variant:"ghost",size:"icon",onClick:()=>A((0,m.W)(Z,1)),children:(0,l.jsx)(h.Z,{className:"h-5 w-5"})}),(0,l.jsx)("h2",{className:"text-lg font-semibold text-center w-40",children:(0,c.WU)(Z,"MMMM yyyy")}),(0,l.jsx)(g.z,{variant:"ghost",size:"icon",onClick:()=>A((0,x.z)(Z,1)),children:(0,l.jsx)(h.Z,{className:"h-5 w-5 rotate-180"})})]}),er?(0,l.jsx)(E.O,{className:"h-80 w-full"}):(0,l.jsxs)("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",children:[(0,l.jsx)("div",{className:"grid grid-cols-7 text-center text-sm font-semibold text-muted-foreground p-2",children:["S","M","T","W","T","F","S"].map((e,s)=>(0,l.jsx)("div",{children:e},"".concat(e,"-").concat(s)))}),(0,l.jsxs)("div",{className:"grid grid-cols-7 border-t",children:[Array.from({length:ei.getDay()}).map((e,s)=>(0,l.jsx)("div",{className:"h-20 border-l border-b"},"empty-start-".concat(s))),ec.map(e=>{let s=(0,c.WU)(e,"yyyy-MM-dd"),t=F.some(s=>(0,u.K)(s,e)),{text:a,color:n,netAvailable:r}=ed(e);return(0,l.jsxs)("button",{onClick:()=>eo(e),className:(0,w.cn)("h-20 flex flex-col items-center justify-center transition-colors focus:outline-none border-l border-b p-1 text-center",n,t&&"ring-2 ring-primary ring-offset-1 z-10"),children:[(0,l.jsx)("span",{className:"font-semibold text-lg",children:(0,c.WU)(e,"d")}),(0,l.jsx)("span",{className:"text-xs font-medium",children:a}),(0,l.jsxs)("span",{className:"text-xs",children:[r," left"]})]},s)}),Array.from({length:(7-((0,i.V)(Z).getDay()+1))%7}).map((e,s)=>(0,l.jsx)("div",{className:"h-20 border-l border-b"},"empty-end-".concat(s)))]})]}),F.length>0&&K&&(0,l.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold",children:null==W?void 0:W.name}),(0,l.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Editing ",F.length," ",1===F.length?"date":"dates"]})]}),(0,l.jsx)(N.Zb,{className:"shadow-soft rounded-2xl",children:(0,l.jsxs)(N.aY,{className:"p-4 space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(C._,{children:"Booking Status"}),(0,l.jsxs)(M.E,{value:K.closed?"closed":"open",onValueChange:e=>ea(e),className:"flex items-center gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(M.m,{value:"open",id:"open"}),(0,l.jsx)(C._,{htmlFor:"open",children:"Open"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(M.m,{value:"closed",id:"closed"}),(0,l.jsx)(C._,{htmlFor:"closed",children:"Close"})]})]})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(C._,{children:"Total Inventory"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(g.z,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>en(-1),disabled:K.closed,children:(0,l.jsx)(v.Z,{className:"h-4 w-4"})}),(0,l.jsx)("span",{className:"font-bold text-lg w-8 text-center",children:K.available}),(0,l.jsx)(g.z,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>en(1),disabled:K.closed,children:(0,l.jsx)(y.Z,{className:"h-4 w-4"})})]})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(C._,{children:"Nightly Price"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-muted-foreground",children:"$"}),(0,l.jsx)(k.I,{type:"number",value:K.price,onChange:e=>el(()=>({price:Number(e.target.value)})),className:"w-24 font-bold text-lg text-right",disabled:K.closed})]})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(C._,{className:"text-muted-foreground",children:"Booked"}),(0,l.jsx)("span",{className:"font-bold",children:(null==em?void 0:em.bookedCount)||0})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between font-semibold",children:[(0,l.jsx)(C._,{children:"Net Available"}),(0,l.jsx)("span",{children:Math.max(0,K.available-((null==em?void 0:em.bookedCount)||0))})]})]})}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(g.z,{variant:"outline",onClick:()=>L([]),className:"w-full",children:"Clear"}),(0,l.jsxs)(g.z,{onClick:et,className:"bg-shpc-yellow text-shpc-ink hover:bg-shpc-yellow/90 w-full",disabled:T,children:[T&&(0,l.jsx)(j.Z,{className:"mr-2 h-4 w-4 animate-spin"}),T?"Saving...":"Save for ".concat(F.length," Day(s)")]})]}),H&&(0,l.jsxs)(N.Zb,{className:"shadow-soft rounded-2xl bg-destructive/10 border-destructive",children:[(0,l.jsxs)(N.Ol,{children:[(0,l.jsx)(N.ll,{className:"text-destructive",children:"Error Saving"}),(0,l.jsx)(N.SZ,{className:"text-destructive/80",children:"The database rejected the save operation. Here's the error:"})]}),(0,l.jsx)(N.aY,{children:(0,l.jsx)("pre",{className:"text-xs bg-background p-2 rounded-md overflow-x-auto",children:(0,l.jsx)("code",{children:H})})})]})]})]})}function W(e){let{params:s}=e;return(0,l.jsx)(O,{slug:s.slug})}},86700:function(e,s,t){"use strict";t.d(s,{E:function(){return c},m:function(){return d}});var l=t(57437),a=t(2265),n=t(42325),r=t(78084),i=t(93448);let c=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)(n.fC,{className:(0,i.cn)("grid gap-2",t),...a,ref:s})});c.displayName=n.fC.displayName;let d=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)(n.ck,{ref:s,className:(0,i.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:(0,l.jsx)(n.z$,{className:"flex items-center justify-center",children:(0,l.jsx)(r.Z,{className:"h-2.5 w-2.5 fill-current text-current"})})})});d.displayName=n.ck.displayName},69140:function(e,s,t){"use strict";t.d(s,{O:function(){return n}});var l=t(57437),a=t(93448);function n(e){let{className:s,...t}=e;return(0,l.jsx)("div",{className:(0,a.cn)("animate-pulse rounded-md bg-muted",s),...t})}}},function(e){e.O(0,[4728,4358,6137,2972,9242,9666,3301,2901,9221,1056,2559,268,2971,2117,1744],function(){return e(e.s=67879)}),_N_E=e.O()}]);