(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[361],{28250:function(e,t,a){Promise.resolve().then(a.bind(a,59318))},59318:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return M}});var s=a(57437),n=a(2265),r=a(99376),i=a(12381),l=a(79820),o=a(40279),c=a(75060),d=a(31593),m=a(2901),u=a(60936),x=a(5255),p=a(13147),h=a(16994),f=a(81475),g=a(98012),j=a(53459),y=a(5485),v=a(23340),N=a(27648),b=a(68245),w=a(33145),k=a(70001),P=a(44986),S=a(93448);let C=k.fC,I=k.xz,E=k.h_;k.x8;let D=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(k.aV,{ref:t,className:(0,S.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...n})});D.displayName=k.aV.displayName;let U=n.forwardRef((e,t)=>{let{className:a,children:n,...r}=e;return(0,s.jsxs)(E,{children:[(0,s.jsx)(D,{}),(0,s.jsxs)(k.VY,{ref:t,className:(0,S.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...r,children:[n,(0,s.jsxs)(k.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(P.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});U.displayName=k.VY.displayName;let F=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,S.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};F.displayName="DialogHeader";let z=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(k.Dx,{ref:t,className:(0,S.cn)("text-lg font-semibold leading-none tracking-tight",a),...n})});z.displayName=k.Dx.displayName,n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(k.dk,{ref:t,className:(0,S.cn)("text-sm text-muted-foreground",a),...n})}).displayName=k.dk.displayName;var R=a(64822),Z=a(74348),A=a(5978),B=a(72962),Y=a(15169);function _(e){let{bookingDetails:t}=e,{mainExcursion:a,bundledItems:n,totalPrice:r,bundleDiscount:i}=t,o=e=>e.adults*e.price.adult;return(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)(l.Zb,{className:"bg-white shadow-soft rounded-2xl",children:[(0,s.jsx)(l.Ol,{className:"p-6",children:(0,s.jsx)("h3",{className:"text-2xl font-bold",children:"Your Experience"})}),(0,s.jsxs)(l.aY,{className:"p-6 pt-0 space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(q,{item:a}),n.map(e=>(0,s.jsx)(q,{item:e},e.id))]}),(0,s.jsx)(d.Separator,{}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("h4",{className:"font-semibold text-base mb-2",children:"Price Details"}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsxs)("span",{children:[a.title," (",a.adults," Adults)"]}),(0,s.jsxs)("span",{children:["$",o(a).toFixed(2)]})]}),n.map(e=>(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsxs)("span",{children:[e.title," (",e.adults," Adults)"]}),(0,s.jsxs)("span",{children:["$",o(e).toFixed(2)]})]},e.id)),i>0&&(0,s.jsxs)("div",{className:"flex justify-between text-sm text-emerald-600 font-medium",children:[(0,s.jsx)("span",{children:"Bundle Discount"}),(0,s.jsxs)("span",{children:["-$",i.toFixed(2)]})]}),(0,s.jsx)("div",{className:"flex justify-between text-sm text-green-600 font-medium pt-1",children:(0,s.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,s.jsx)(x.Z,{className:"h-4 w-4"}),"All taxes & fees included"]})})]}),(0,s.jsx)(d.Separator,{}),(0,s.jsxs)("div",{className:"flex justify-between font-bold text-lg items-baseline",children:[(0,s.jsx)("span",{children:"Total (USD)"}),(0,s.jsxs)("span",{className:"font-mono text-2xl",children:["$",r.toFixed(2)]})]})]})]})})}function q(e){let{item:t}=e;return(0,s.jsx)("div",{className:"space-y-2 text-sm",children:(0,s.jsxs)("div",{className:"flex gap-4 items-start",children:[(0,s.jsx)(w.default,{src:t.image,alt:t.title,width:80,height:60,className:"rounded-lg object-cover aspect-[4/3]","data-ai-hint":"vacation excursion"}),(0,s.jsxs)("div",{className:"flex-grow",children:[(0,s.jsx)("p",{className:"font-semibold",children:t.title}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground mt-1 space-y-0.5",children:[(0,s.jsxs)("p",{className:"flex items-center gap-1.5",children:[(0,s.jsx)(p.Z,{className:"h-3 w-3"})," ",t.bookingDate?(0,m.WU)((0,u.D)(t.bookingDate),"EEEE, MMM dd"):"Date TBD"]}),(0,s.jsxs)("p",{className:"flex items-center gap-1.5",children:[(0,s.jsx)(h.Z,{className:"h-3 w-3"})," ",t.adults," Adults"]}),(0,s.jsxs)("p",{className:"flex items-center gap-1.5",children:[(0,s.jsx)(f.Z,{className:"h-3 w-3"})," ",t.practicalInfo.duration]}),(0,s.jsxs)("div",{className:"flex items-start gap-1.5",children:[(0,s.jsx)(g.Z,{className:"h-3 w-3 mt-0.5 shrink-0"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{children:t.practicalInfo.pickup}),t.practicalInfo.pickupMapLink&&(0,s.jsxs)(C,{children:[(0,s.jsx)(I,{asChild:!0,children:(0,s.jsx)(i.z,{variant:"link",size:"sm",className:"h-auto p-0 text-xs mt-1 block text-blue-600",children:"View Map"})}),(0,s.jsxs)(U,{className:"max-w-xl",children:[(0,s.jsx)(F,{children:(0,s.jsxs)(z,{children:["Pickup Location for ",t.title]})}),(0,s.jsx)("div",{className:"w-full h-80 rounded-lg overflow-hidden mt-4",children:(0,s.jsx)(R.Z,{mapUrl:t.practicalInfo.pickupMapLink})})]})]})]})]})]})]})]})})}function O(){let e=(0,r.useRouter)(),t=(0,Z.CU)(),{user:a}=(0,Z.aF)(),{toast:d}=(0,v.pm)(),[m,u]=n.useState(null),[x,p]=n.useState(!0),[h,f]=n.useState(!1),[g,w]=n.useState(null),[k,P]=n.useState(""),[S,C]=n.useState(""),[I,E]=n.useState(""),[D,U]=n.useState(""),[F,z]=n.useState(!1),[R,q]=n.useState(!1),[O,M]=n.useState(null);n.useEffect(()=>{let e=localStorage.getItem("excursionBookingDetails");if(e)try{u(JSON.parse(e))}catch(e){console.error("Failed to parse excursion booking details:",e),w("Session data is corrupted. Please start over.")}p(!1)},[]);let $=async a=>{if(!O||!t){d({title:"Critical Error",description:"Final booking data is missing. Please contact support.",variant:"destructive"});return}f(!0);let s={...O,paypalOrderId:a.orderId,paypalTransactionId:a.transactionId,status:"Confirmed",updatedAt:(0,A.Bt)()};try{let a=await (0,A.ET)((0,A.hJ)(t,"serviceBookings"),s);d({title:"Booking Confirmed!",description:"Your payment was successful and your excursion is confirmed.",variant:"default"});try{console.log("Attempting to send confirmation email for booking ".concat(a.id)),await (0,Y.o)(a.id),console.log("Successfully queued confirmation email for booking ".concat(a.id)),d({title:"Email Sent",description:"Your confirmation email is on its way.",variant:"default"})}catch(e){console.error("Failed to send confirmation email for booking ".concat(a.id,":"),e),d({title:"Email Failed",description:"Could not send confirmation email. Please contact support.",variant:"destructive"})}localStorage.removeItem("excursionBookingDetails"),e.push("/confirmation/excursions?bid=".concat(a.id))}catch(e){console.error("Database write failed after payment:",e),d({title:"Payment Succeeded, Booking Failed",description:"Your payment was processed, but we failed to save your booking. Please contact support immediately with your PayPal details.",variant:"destructive",duration:15e3})}finally{f(!1),q(!1)}};return x?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)(j.Z,{className:"h-8 w-8 animate-spin"})}):m?(0,s.jsx)("div",{className:"bg-shpc-sand min-h-screen py-12 px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,s.jsxs)(i.z,{variant:"ghost",onClick:()=>e.back(),className:"mb-4",children:[(0,s.jsx)(y.Z,{className:"mr-2 h-4 w-4"}),"Back"]}),(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row gap-8 lg:gap-12 items-start",children:[(0,s.jsxs)("div",{className:"w-full flex flex-col space-y-8",children:[(0,s.jsxs)(l.Zb,{className:"shadow-soft rounded-2xl",children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(l.ll,{children:"Whoâ€™s Joining Us?"})}),(0,s.jsxs)(l.aY,{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(c._,{htmlFor:"first-name",children:["First Name",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(o.I,{id:"first-name",placeholder:"John",value:k,onChange:e=>P(e.target.value),required:!0})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(c._,{htmlFor:"last-name",children:["Last Name",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(o.I,{id:"last-name",placeholder:"Doe",value:S,onChange:e=>C(e.target.value),required:!0})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(c._,{htmlFor:"email",children:["Email",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(o.I,{id:"email",type:"email",placeholder:"john@example.com",value:I,onChange:e=>E(e.target.value),required:!0})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(c._,{htmlFor:"phone",children:"Phone"}),(0,s.jsx)(o.I,{id:"phone",type:"tel",placeholder:"+1 (809) 123-4567",value:D,onChange:e=>U(e.target.value)})]})]}),(0,s.jsxs)("div",{className:"flex items-start space-x-3 pt-4",children:[(0,s.jsx)(b.X,{id:"terms",checked:F,onCheckedChange:e=>z(e)}),(0,s.jsxs)(c._,{htmlFor:"terms",className:"text-sm text-muted-foreground font-normal",children:["I confirm that I have read the ",(0,s.jsx)(N.default,{href:"/privacy",target:"_blank",className:"underline hover:text-primary",children:"Privacy Statement"})," and the ",(0,s.jsx)(N.default,{href:"/terms/excursions",target:"_blank",className:"underline hover:text-primary",children:"Terms of Service"}),"."]})]})]})]}),g&&(0,s.jsx)("p",{className:"text-destructive text-sm font-medium p-3 bg-destructive/10 rounded-md",children:g}),R?(0,s.jsxs)(l.Zb,{className:"shadow-soft rounded-2xl",children:[(0,s.jsxs)(l.Ol,{children:[(0,s.jsx)(l.ll,{children:"Complete Your Payment"}),(0,s.jsxs)(l.SZ,{children:["Final amount: $",m.totalPrice.toFixed(2)," USD"]})]}),(0,s.jsxs)(l.aY,{children:[O&&(0,s.jsx)(B.l,{amount:O.pricing.totalUSD.toFixed(2),currency:O.pricing.currency,onPaymentSuccess:$,onPaymentError:e=>{f(!1),q(!1),console.error("Payment process failed:",e)}}),(0,s.jsx)(i.z,{variant:"outline",className:"w-full h-12 mt-4",onClick:()=>q(!1),disabled:h,children:"Go Back"})]})]}):(0,s.jsx)(i.z,{size:"lg",className:"w-full h-12",onClick:()=>{var e;if(w(null),!k||!S||!I||!F){w("Please fill in all required fields and accept the terms.");return}if(!m){w("Booking details are missing. Please start over.");return}let t=[m.mainExcursion,...m.bundledItems];M({type:"excursion",customer:{name:"".concat(k," ").concat(S),email:I,phone:D},pricing:{totalUSD:m.totalPrice,currency:"USD"},status:"Pending Payment",createdAt:(0,A.Bt)(),updatedAt:(0,A.Bt)(),guestUid:null!==(e=null==a?void 0:a.uid)&&void 0!==e?e:null,items:t.map(e=>({excursionId:e.id,excursionName:e.title,date:e.bookingDate,pax:"".concat(e.adults," Adults")}))}),q(!0)},disabled:h,children:h?(0,s.jsx)(j.Z,{className:"animate-spin"}):"Proceed to Payment"})]}),(0,s.jsx)("div",{className:"w-full lg:w-2/3 lg:sticky top-24",children:(0,s.jsx)(_,{bookingDetails:m})})]})]})}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen text-center p-4",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Booking Session Expired"}),(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:"Please start a new search."}),(0,s.jsxs)(i.z,{onClick:()=>e.push("/excursions"),children:[(0,s.jsx)(y.Z,{className:"mr-2 h-4 w-4"}),"Back to Excursions"]})]})}function M(){return(0,s.jsx)(n.Suspense,{fallback:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)(j.Z,{className:"h-8 w-8 animate-spin"})}),children:(0,s.jsx)(O,{})})}},72962:function(e,t,a){"use strict";a.d(t,{l:function(){return c}});var s=a(57437);a(2265);var n=a(61542),r=a(23340);a(83079);var i=a(12119),l=(0,i.$)("26d34a2436a52c3b6d2a079c5e05cc9c7d3b4b35"),o=(0,i.$)("011893b7f4967695614536f456b192c1aa90b125");function c(e){let{amount:t,currency:a,onPaymentSuccess:i,onPaymentError:c}=e,{toast:d}=(0,r.pm)(),m="AXq7eJpeSOd3qbCEX_88yc9TFm8-M3CEd7JUGoKH7KJVH9Z9e0IOeqAsamYl6m6VyemOvi0rXKQ2xAFu";return m?(0,s.jsx)(n.Vv,{options:{clientId:m,currency:a,intent:"capture"},children:(0,s.jsx)(n.ch,{style:{layout:"vertical"},createOrder:async()=>{try{let e=await o(t,a);if(!e)throw Error("Server did not return a valid Order ID.");return e}catch(e){throw d({title:"Payment Error",description:"Could not initiate PayPal payment: ".concat(e.message),variant:"destructive"}),c(e),e}},onApprove:async e=>{try{let t=await l(e.orderID);if(!t)throw Error("Server did not return a valid Transaction ID.");d({title:"Payment Successful!",description:"Your payment has been processed."}),await i({orderId:e.orderID,transactionId:t})}catch(e){throw d({title:"Payment Failed",description:"We could not process your payment: ".concat(e.message),variant:"destructive"}),c(e),e}},onCancel:()=>{d({title:"Payment Cancelled",description:"Your payment was not processed."}),c(Error("Payment cancelled by user."))},onError:e=>{console.error("PayPal SDK Error:",e),d({title:"PayPal Error",description:"An unexpected error occurred with PayPal. Please try again.",variant:"destructive"}),c(e)}})}):(console.error("PayPal Client ID is not defined in environment variables."),(0,s.jsxs)("div",{className:"text-red-500 p-4 bg-red-100 border border-red-400 rounded-md",children:[(0,s.jsx)("b",{children:"Payment Error:"})," PayPal is not configured correctly.",(0,s.jsx)("p",{className:"text-xs mt-2",children:"Please contact support to resolve this issue."})]}))}},64822:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var s=a(57437);let n=e=>{try{let t=new URL(e);if(t.pathname.includes("/dir/")){let e=t.pathname.split("/dir/")[1].split("/");if(e.length>=2)return{origin:decodeURIComponent(e[0].replace(/\+/g," ")),destination:decodeURIComponent(e[1].replace(/\+/g," ")),mode:t.searchParams.get("travelmode")}}let a=t.searchParams.get("origin"),s=t.searchParams.get("destination");if(a&&s)return{origin:a,destination:s,mode:t.searchParams.get("travelmode")};return{origin:null,destination:null,mode:null}}catch(e){return console.error("Error parsing map URL:",e),{origin:null,destination:null,mode:null}}},r=e=>{try{let t=new URL(e);if(t.pathname.startsWith("/maps/place/")){let e=t.pathname.split("/");if(e.length>3)return decodeURIComponent(e[3].replace(/\+/g," "))}if(t.pathname.includes("/maps/search/")){let e=t.pathname.split("/maps/search/");if(e[1])return decodeURIComponent(e[1].split("/")[0])}return t.searchParams.get("q")}catch(e){return console.error("Invalid map URL",e),null}};function i(e){let t,a,{mapUrl:i,origin:l,mode:o="driving",zoom:c=15}=e,d="AIzaSyCKYYBKsEQ-qvhlm0GnkU86yMuBSqIljZg";if(!d)return console.error("Google Maps API key is missing."),(0,s.jsx)("div",{className:"text-red-500 text-xs",children:"Map cannot be displayed: Missing API Key."});let m=n(i);if(m.origin&&m.destination){let e=m.origin;a=m.destination;let s=m.mode||o;t="https://www.google.com/maps/embed/v1/directions?key=".concat(d,"&origin=").concat(encodeURIComponent(e),"&destination=").concat(encodeURIComponent(a),"&mode=").concat(s,"&zoom=").concat(c)}else a=r(i)||"Sweet Home Punta Cana",t=l?"https://www.google.com/maps/embed/v1/directions?key=".concat(d,"&origin=").concat(encodeURIComponent(l),"&destination=").concat(encodeURIComponent(a),"&mode=").concat(o,"&zoom=").concat(c):"https://www.google.com/maps/embed/v1/place?key=".concat(d,"&q=").concat(encodeURIComponent(a),"&zoom=").concat(c);return(0,s.jsx)("div",{className:"aspect-video w-full rounded-lg overflow-hidden border",children:(0,s.jsx)("iframe",{width:"100%",height:"100%",style:{border:0},loading:"lazy",allowFullScreen:!0,referrerPolicy:"no-referrer-when-downgrade",src:t})})}},68245:function(e,t,a){"use strict";a.d(t,{X:function(){return o}});var s=a(57437),n=a(2265),r=a(9270),i=a(59559),l=a(93448);let o=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(r.fC,{ref:t,className:(0,l.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...n,children:(0,s.jsx)(r.z$,{className:(0,l.cn)("flex items-center justify-center text-current"),children:(0,s.jsx)(i.Z,{className:"h-4 w-4"})})})});o.displayName=r.fC.displayName},31593:function(e,t,a){"use strict";a.d(t,{Separator:function(){return l}});var s=a(57437),n=a(2265),r=a(55156),i=a(93448);let l=n.forwardRef((e,t)=>{let{className:a,orientation:n="horizontal",decorative:l=!0,...o}=e;return(0,s.jsx)(r.f,{ref:t,decorative:l,orientation:n,className:(0,i.cn)("shrink-0 bg-border","horizontal"===n?"h-[1px] w-full":"h-full w-[1px]",a),...o})});l.displayName=r.f.displayName},15169:function(e,t,a){"use strict";a.d(t,{o:function(){return s}}),a(83079);var s=(0,a(12119).$)("65d69c8047e7940336b866a5779e2a5363aa7bc6")}},function(e){e.O(0,[4728,4358,6137,2972,5878,9242,3301,2901,9221,2778,1636,4269,268,2971,2117,1744],function(){return e(e.s=28250)}),_N_E=e.O()}]);